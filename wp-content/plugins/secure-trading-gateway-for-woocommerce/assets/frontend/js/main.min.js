jQuery(document).ready(function(e){function t(){e("#"+st_object.id+"-card-cvc").removeAttr("name"),e("#"+st_object.id+"-card-number").removeAttr("name")}var o="st-payment";function r(){return e("form#"+o+' input[name="payment_method"]:checked').val()===st_object.id&&($return=!0,(e("#wc-"+st_object.id+"-payment-token-new").is(":checked")||0===e("#wc-"+st_object.id+"-payment-token-new").length)&&(function(){var t=e("#"+st_object.id+"-card-expiry").val(),o=t.split(" / "),r=new Date,c=!0,d=4;"1"===st_object.two_digits_date&&(d=2);if(0===t.length)return a("Date field required."),!1;2===o[0].length&&o[1].length===d||("1"===st_object.two_digits_date?a("Invalid expiry date format please use MM / YY."):a("Invalid expiry date format please use MM / YYYY. 1"),c=!1);(parseInt(o[0])>12||0===parseInt(o[0]))&&(a("Invalid date month."),c=!1);parseInt(o[1])<r.getFullYear()-2e3&&(a("Invalid date year."),c=!1);4===d&&parseInt(o[1])<r.getFullYear()&&(a("Invalid date year."),c=!1);d!==o[1].length&&(a("Invalid date year."),c=!1);c&&(e("#"+st_object.id+"-cc-month").val(o[0]).trigger("change"),void 0!==o[1]&&("1"===st_object.two_digits_date?e("#"+st_object.id+"-cc-year").val("20"+o[1]).trigger("change"):e("#"+st_object.id+"-cc-year").val(o[1]).trigger("change")));return c}()||($return=!1),function(){var t=!0;3!==e("#"+st_object.id+"-card-cvc").val().length&&4!==e("#"+st_object.id+"-card-cvc").val().length&&(d("Invalid security code length.",e("#"+st_object.id+"-card-cvc")),t=!1);return t}()||($return=!1),(t=e("#"+st_object.id+"-card-number").val().split(" ").join(""))&&function(e){for(var t=0,o=!1,r=e.length-1;r>=0;r--){var c=+e[r];o&&(c*=2)>9&&(c-=9),t+=c,o=!o}return t%10==0}(t)&&16==t.length&&(4==t[0]||5==t[0]&&t[1]>=1&&t[1]<=5||0==t.indexOf("6011")||0==t.indexOf("65"))||5==t[0]&&t[1]>=0||15==t.length&&(0==t.indexOf("34")||0==t.indexOf("37"))||16==t.length&&(0==t.indexOf("22")||0==t.indexOf("67"))||13==t.length&&4==t[0]||19==t.length&&6==t[0]||14==t.length&&3==t[0]||(d("Invalid credit card number.",e("#"+st_object.id+"-card-number")),0)||($return=!1)),$return);var t}function c(t){var o=8;if("1"===st_object.two_digits_date&&(o=6),t.val().length>=o&&t.val(t.val().slice(0,o+1)),-1===t.val().indexOf(" / ")&&t.val().indexOf("/")>=0&&t.val(t.val().replace("/"," / ")),t.val().indexOf(" / ")){var r=t.val().split(" / ");e("#"+st_object.id+"-cc-month").val(r[0]),void 0!==r[1]&&("1"===st_object.two_digits_date?e("#"+st_object.id+"-cc-year").val("20"+r[1]):e("#"+st_object.id+"-cc-year").val(r[1]))}}function a(t){d(t,e("#"+st_object.id+"-card-expiry"))}function d(t,o){e(".wc-st_gateway-cc-form .woocommerce-invalid").removeClass("woocommerce-invalid"),e(".wc-st_gateway-cc-form .woocommerce-invalid-required-field").removeClass("woocommerce-invalid-required-field"),o.parent().addClass("woocommerce-invalid woocommerce-invalid-required-field"),o.focus();var r='<div class="woocommerce-error" role="alert">'+t+"</div>";e(".woocommerce-notices-wrapper").first().html(r),e(document.body).trigger("checkout_error"),e.scroll_to_notices(e(".woocommerce-notices-wrapper:first-of-type")),e("#add_payment_method").length&&setTimeout(function(){e("#add_payment_method").unblock()},100)}e("body.woocommerce-order-pay #order_review").length?o="order_review":e("body.woocommerce-add-payment-method #add_payment_method").length&&(o="add_payment_method"),t(),e('form[name="checkout"]').attr("id","st-payment"),e(document).on("change",'input[name="wc-st_gateway-payment-token"]',function(){t(),"new"!==e(this).val()?(e("#"+st_object.id+"-card-cvc").removeAttr("required"),e("#"+st_object.id+"-card-number").removeAttr("required"),e("#"+st_object.id+"-card-expiry").removeAttr("required")):(e("#"+st_object.id+"-card-cvc").attr("required","required"),e("#"+st_object.id+"-card-number").attr("required","required"),e("#"+st_object.id+"-card-expiry").attr("required","required"))}),e(document).on("change","form#"+o+' input[name="payment_method"]:checked',function(){new SecureTrading.Standard({sitereference:st_object.sitereference,locale:"en_gb",formId:o,submitFormCallback:function(r){if(e("form#"+o+' input[name="payment_method"]:checked').val()==st_object.id)if(t(),e("#st-message").empty(),e("#wc-"+st_object.id+"-payment-token-new").is(":checked")||"add_payment_method"===o||0===e("#wc-"+st_object.id+"-payment-token-new").length){var c;if(void 0===r.response[0].cachetoken||0!==r.response[0].errorcode)return e(".woocommerce-error, .woocommerce-message").remove(),(c=e("form#"+o)).prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-updateOrderReview"><div class="woocommerce-error">There was a problem processing your order.</div></div>'),void e("html, body").animate({scrollTop:c.offset().top-100},1e3);if(void 0===r.response[0].cachetoken)return e(".woocommerce-error, .woocommerce-message").remove(),(c=e("form#"+o)).prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-updateOrderReview"><div class="woocommerce-error">There was a problem processing your order.</div></div>'),void e("html, body").animate({scrollTop:c.offset().top-100},1e3);var a=r.response[0].cachetoken,d=new Date;e("formform#"+o).data("token-time",d.getTime()),e("#"+st_object.id+"-cachetoken").val(a),e("form#"+o).trigger("submit")}else e("form#"+o).trigger("submit")},validateRequestObjectCallback:function(c){if(r()){if(t(),e("form#"+o+' input[name="payment_method"]:checked').val()==st_object.id&&e("#wc-"+st_object.id+"-payment-token-new").is(":checked")){if(!c){var a=e("form#"+o);a.prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-updateOrderReview"><div class="woocommerce-error">Credit Card details required</div></div>'),e("html, body").animate({scrollTop:a.offset().top-100},1e3),a.unblock()}return c}return!0}return!1},errorCallback:function(r){var c=e("form#"+o);if(t(),e("form#"+o+' input[name="payment_method"]:checked').val()!=st_object.id||0!==e("#wc-"+st_object.id+"-payment-token-new").length&&!e("#wc-"+st_object.id+"-payment-token-new").is(":checked")&&"add_payment_method"!==o)return!0;e(".woocommerce-error, .woocommerce-message").remove();var a="";e.each(r,function(e,t){a+='<div class="woocommerce-error message-'+e+'">'+t[1]+"</div>"}),c.prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-updateOrderReview">'+a+"</div>"),e("html, body").animate({scrollTop:c.offset().top-100},1e3),c.unblock()}})}),e(document).on("change","#"+st_object.id+"-card-number, #"+st_object.id+"-card-cvc, #"+st_object.id+"-card-expiry",function(){e("#"+st_object.id+"-cachetoken").val("")}),e(document).on("change keyup","#"+st_object.id+"-card-expiry",function(){c(e("#"+st_object.id+"-card-expiry"))}),e("#"+st_object.id+"-card-expiry").trigger("keyup").change(),e("form#"+o+' input[name="payment_method"]').trigger("change"),e("form#"+o).on("checkout_place_order_st_gateway",function(o){var c=new Date;return!(e("#wc-"+st_object.id+"-payment-token-new").is(":checked")&&!r())&&(t(),void 0!==e("form.checkout").data("token-time")&&parseInt(c.getTime()-parseInt(e("form.checkout").data("token-time"))/100/60>14)&&e("#"+st_object.id+"-cachetoken").val(""),""!==e("#"+st_object.id+"-cachetoken").val()||!e("#wc-"+st_object.id+"-payment-token-new").is(":checked")&&0!==e("#wc-"+st_object.id+"-payment-token-new").length)}),e("body").hasClass(".woocommerce-checkout")&&!"body".hasClass("woocommerce-order-received")&&""!==e("#"+st_object.id+"-card-expiry").val()&&c(e("#"+st_object.id+"-card-expiry"))});